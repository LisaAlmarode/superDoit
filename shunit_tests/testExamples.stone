#! /usr/bin/env bash

echo "GITHUB_WORKSPACE=$GITHUB_WORKSPACE"

if [ "$GITHUB_WORKSPACE" != "" ] ; then
	# running github ci test PLATFORM and GS_VERS are preset
	if [ "$PLATFORM" = "macos-10.15" ] ; then
		export GEMSTONE="${GITHUB_WORKSPACE}/gemstone/products/GemStone64Bit${GS_VERS}-i386.Darwin"
	else
		export GEMSTONE="${GITHUB_WORKSPACE}/gemstone/products/GemStone64Bit${GS_VERS}-x86_64.Linux"
	fi
	export GEMSTONE_TOPAZINI_PATH=${GITHUB_WORKSPACE}/gemstone/stones/gs_${GS_VERS}/.topazini
	. ${GITHUB_WORKSPACE}/dev/defPath.env
	PATH=${GITHUB_WORKSPACE}/examples/simple:$PATH

fi
echo "GEMSTONE=$GEMSTONE"
echo "GEMSTONE_TOPAZINI_PATH=$GEMSTONE_TOPAZINI_PATH"

stone_require_args="-- -l -I $GEMSTONE_TOPAZINI_PATH"


test_errorWithHelp_stone() {
	# run without error
	errorWithHelp.stone -h			$stone_require_args
	errorWithHelp.stone --help		$stone_require_args
}

test_simplest_stone() {
	# run without error
	seven=`simplest.stone	$stone_require_args`
	assertEquals "wrong answer" '7' "${seven}"
	simplest.stone -h	$stone_require_args
	simplest.stone --help	$stone_require_args
	simplest.stone -D	$stone_require_args
	simplest.stone --debug	$stone_require_args
}

test_simpleArgs_1_stone() {
	# run without error
	seven=`simpleArgs.stone --addend=4	$stone_require_args`
	assertEquals "wrong answer" '7' "${seven}"
}

test_simpleArgs_2_stone() {
	# run without error
	seven=`simpleArgs.stone -a 4	$stone_require_args`
	assertEquals "wrong answer" '7' "${seven}"
}

. shunit_tests/shunit2-2.1.8/shunit2_test_helpers
. shunit_tests/shunit2-2.1.8/shunit2


